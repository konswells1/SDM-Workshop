{
  "hash": "7281eccc74fb44cc359a4c623299d3bb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Environmental Data\"\nformat: html\neditor: visual\ndraft: false\n---\n\n\n\nIn species distribution modelling (SDM) and related ecological applications such as habitat suitability assessments, understanding the relationship between species occurrences and the underlying environmental conditions is essential. **Environmental data** form the backbone of SDMs, providing the contextual information needed to analyse where species are found and, importantly, where they could be found under different conditions (according to the predictions from the underlying model).\n\nSince SDMs aim not only to identify ecological relationships but also to project these relationships across broader spatial extents or under future environmental scenarios, access to landscape-scale environmental data is critical. Environmental variables of **abiotic conditions such as climate, topography, soil, and land cover** or commonly of key interest to describe the ecological and spatial constraints that influence species distributions. These variables are often derived from remote sensing products, interpolated climate surfaces, digital elevation models, and in-situ measurements.\n\nSelecting relevant and high-quality environmental predictors is a key step in building robust, interpretable models. Considerations such as spatial and temporal resolution, variable collinearity, and ecological relevance all play a role in shaping model outcomes.\n\n<br>\n\nIn this part of the workshop, we will:\n\nExplore the main types of environmental datasets commonly used in SDM\n\nDiscuss spatial and temporal resolution — and why they matter\n\nLearn how to access, prepare, and manage environmental layers for modelling\n\nAddress common challenges such as collinearity, scaling, and data gaps\n\nUnderstanding your environmental data is just as important as understanding your species data.\n\nTogether, they define the basis for making informed, ecologically meaningful predictions about species distributions, be it in the present, the past, and under future scenarios.\n\n::: {.callout-note collapse=\"true\" icon=\"package\"}\n### Required R Packages for This Section\n\nBefore continuing, make sure the following R packages are installed and loaded:\n\n-   `terra` – for working with spatial raster and vector data\n-   `rnaturalearth` – for country/world map boundaries\n-   `rnaturalearthdata` – Natural Earth support data\n-   `ggplot2` – for plotting\n-   `sf` – for handling vector data in simple features (sf) format\n-   `geodata` – easy access to global environmental raster layers\n\n\n::: {.cell}\n\n:::\n\n:::\n\n<br>\n\n## 1. Climate data\n\nClimate variables are critical predictors in SDMs, as they directly influence species physiology, habitat suitability, and ecological interactions. Commonly used climate variables include temperature (e.g., mean annual, maximum of warmest month), precipitation (e.g., total annual, seasonality), and derived bioclimatic variables.\n\nIn R, climate data can be easily accessed, processed, and visualized using a combination of packages and global datasets. One of the most widely used sources is **WorldClim**, which provides high-resolution global climate layers. You can explore the available variables [here](https://www.worldclim.org/data/bioclim.html). To download and use these data in R, this can be efficiently done with the package. Other sources of climate data include for example the [CHELSA](https://chelsa-climate.org/) database\n\n#### 1.1 Accessing climate data\n\nThe `geodata` package simplifies the process of downloading WorldClim and CHELSA data. As discussed in the section \"3. Raster Data in R\", the tera package can be used to crop and mask climate data to the study region to reduce computational load and improve model relevance.\n\n##### Code to access climate data (already done in data preparation)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required libraries\nlibrary(rnaturalearth)\nlibrary(terra)\nlibrary(geodata)\n\n# Create a temporary directory to store raster data\ntmp_dir <- tempdir()  # automatically cleaned up when R session ends\n\n# Download WorldClim bioclimatic variables (1970–2000 baseline)\nClim_extant <- geodata::worldclim_global(var = \"bio\", \n                        res = 10,          # resolution of 10 arc-minutes (~18 km)\n                        path = tmp_dir)   \n\n# View variable names\nnames(Clim_extant)\n\n# UK map\nUK_sf <- ne_countries(scale = \"medium\", country = \"United Kingdom\", returnclass = \"sf\")\nUK_vect <- terra::vect(UK_sf)\n\nClim_UK_crop <- terra::crop(Clim_extant, UK_vect)\nClim_UK <- terra::mask(Clim_UK_crop, UK_vect)\n\n# Data is in memory and temporary folder; no permanent files created\n```\n:::\n\n\n##### Plot climate data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define color palette\ncol_palette <- colorRampPalette(c(\"blue\", \"yellow\", \"orange\"))(20)\n\n# Plot the first bioclimatic variable for the UK\nplot(Clim_UK[[1]], \n     main = names(Clim_UK)[1], \n     col = col_palette)\n```\n\n::: {.cell-output-display}\n![](page_SDM.4_EnvironmentalData_files/figure-html/plot-climate-data-1.png){width=672}\n:::\n:::\n\n\n<br>\n\n#### 1.2 Future climate data\n\nProjecting future species distributions under climate change is essential for understanding potential range shifts, extinction risks, and guide future conservation planning. Future climate data provide model inputs that represent different greenhouse gas concentration trajectories over time.\n\nThese data are generated by **global climate models (GCM)** and made available through datasets like WorldClim and CHELSA, which provide downscaled, bias-corrected projections for various future scenarios. Downscaled future climate data from WorldClim v2.1, which includes projections from multiple GCMs can be also accessed with the help of the `geodata` package. In this workshop, we use **CMIP-6** (Coupled Model Intercomparison Project Phase 6) climate projections, which provide simulations of future climate based on various greenhouse gas concentration pathways (known as SSPs). These models incorporate complex physical processes and interactions within the atmosphere, oceans, land surface, and ice.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download future climate data (CMIP6 projections for 2041–2060)\n# We use bioclimatic variables (bioc) at 5 arc-min resolution (~9 km)\n# Scenario: SSP1-2.6 (“Paris Agreement compatible”), GCM = BCC-CSM2-MR\n# SSP1: Sustainability pathway – world shifts toward green growth and equity\n# Radiative forcing stabilizes at 2.6 W/m² by 2100\nClim_cmip6_2041_2060 <- geodata::cmip6_world(\n  var   = \"bioc\",        # bioclimatic variables\n  ssp   = \"126\",         # SSP1-2.6 scenario\n  model = \"BCC-CSM2-MR\", # Global climate model\n  time  = \"2041-2060\",   # target period\n  res   = 5,             # resolution (arc-minutes)\n  path  = \"data/\"        # folder to save downloaded files\n)\n\n# View variable names\nnames(Clim_future_cmip6_2041_2060)\n\n# Plot a variable (e.g., future annual mean temperature)\nterra::plot(Clim_future_cmip6_2041_2060[[1]])\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](page_SDM.4_EnvironmentalData_files/figure-html/plot-cmip6-1.png){width=672}\n:::\n:::\n\n\nThe figure below shows the **projected change in annual mean temperature** relative to a historical baseline (1970–2000). The animation cycles through three future periods (2021–2040, 2041–2060, 2061–2080). Each frame represents the spatial pattern of temperature change (in °C) predicted by CMIP-6 for that period, highlighting where and by how much temperatures are expected to increase or decrease in the UK.\n\n![Projected temperature change over time according to the CMIP-6 model.](images/UK_temperature_change_Diff.gif)\n\n<br>\n\n::: {.callout-note collapse=\"true\" icon=\"info\"}\n### Choosing among GCMs and SSPs scenarios {.callout-note}\n\nThere is no single \"best” model or scenario for future climates. Best practice includes:\n\n-   **Ensemble modelling**: Use multiple GCMs to average predictions and estimate uncertainty.\n-   **Scenario comparison**: Run projections under different Shared Socioeconomic Pathways (SSP) to capture a range of plausible futures.\n-   **Temporal exploration**: Compare mid- and end-century scenarios for temporal trends.\n:::\n\n<br><br>\n\n\n## 2. Elevation data\n\nElevation data are available from different sources, the 'geodata' package offers a direct download of Shuttle Radar Topography Mission (SRTM) data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(geodata)\n\n# Download elevation data\nElev_UK <- geodata::elevation_30s(country = \"GB\", path = tmp_dir)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: object 'tmp_dir' not found\n```\n\n\n:::\n:::\n\n\n\n\n## 3. Land cover data\n\nLand cover is an essential environmental predictor in species distribution modelling (SDM), representing the physical surface of the Earth—such as forests, grasslands, wetlands, croplands, and urban areas. It provides crucial information about habitat availability, fragmentation, and human impacts on ecosystems.\n\nIn R, land cover data can be accessed and processed using remote sensing-derived datasets and spatial packages.\n\n------------------------------------------------------------------------\n\n### Accessing Global Land Cover Data\n\nSeveral global land cover datasets are publicly available, including:\n\n-   [**Copernicus CGLS-LC100**](https://land.copernicus.eu/en/products/global-dynamic-land-cover): Global land cover maps at 100m spatial resolution\n-   [**MODIS MCD12Q1**](https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MCD12Q1): Global land cover maps at 500m resolution\n-   [**ESA WorldCover**](https://esa-worldcover.org/en): Global land cover at 10m resolution\n-   [**MODIS NDVI (Normalized Difference Vegetation Index)**](https://modis.gsfc.nasa.gov/data/dataprod/mod13.php): Satellite-derived vegetation greenness index available at 250m resolution, useful for tracking vegetation health and phenology.\n-   [**Sentinel-2 Vegetation Indices**](https://dataspace.copernicus.eu/data-collections/copernicus-sentinel-data/sentinel-2): High-resolution (10-60m) vegetation indices including NDVI, EVI, and others, from the European Sentinel-2 mission.\n\nAmong these, the ESA WorldCover dataset can be accessed and downloaded using the `geodata` R package. However, this direct download option is not available for all land cover datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# EDS land cover data (variable selected: trees) for the UK\nlc_trees <- geodata::landcover(var = \"trees\")\n```\n:::\n\n\n------------------------------------------------------------------------\n\n# 4. Joining different datasets\n\nIn species distribution modelling (SDM) and related geospatial applications in environmental sciences, we often work with multiple types and layers of data, including different environmental variables, species occurrence records, and related metadata.\n\nBefore building robust and biologically meaningful models, it is critical to properly **prepare and join** these datasets. This involves ensuring that environmental raster layers are first **aligned and stacked**, that is, standardized to the same spatial resolution, extent, and coordinate reference system so that they can be consistently and efficiently used together. Following this, species data and other attributes must be spatially and temporally aligned and **joined** across formats (e.g., raster versus vector data).\n\nThere are two primary types of joins you'll typically perform: 1. **Spatial joins**: Linking species occurrences to environmental conditions, for example, by extracting temperature or land cover values at occurrence points. 2. **Attribute joins**: Merging additional non-spatial data, such as species traits or survey metadata, based on common identifiers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nlibrary(geodata)\n\n# Check CRS and resolution for the two raster files of climate and elevation data\nprint(crs(Clim_UK))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"WGS 84\\\",\\n    ENSEMBLE[\\\"World Geodetic System 1984 ensemble\\\",\\n        MEMBER[\\\"World Geodetic System 1984 (Transit)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G730)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G873)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1150)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1674)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1762)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2139)\\\"],\\n        ELLIPSOID[\\\"WGS 84\\\",6378137,298.257223563,\\n            LENGTHUNIT[\\\"metre\\\",1]],\\n        ENSEMBLEACCURACY[2.0]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"World.\\\"],\\n        BBOX[-90,-180,90,180]],\\n    ID[\\\"EPSG\\\",4326]]\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(crs(Elev_UK))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"WGS 84\\\",\\n    ENSEMBLE[\\\"World Geodetic System 1984 ensemble\\\",\\n        MEMBER[\\\"World Geodetic System 1984 (Transit)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G730)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G873)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1150)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1674)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1762)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2139)\\\"],\\n        ELLIPSOID[\\\"WGS 84\\\",6378137,298.257223563,\\n            LENGTHUNIT[\\\"metre\\\",1]],\\n        ENSEMBLEACCURACY[2.0]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"World.\\\"],\\n        BBOX[-90,-180,90,180]],\\n    ID[\\\"EPSG\\\",4326]]\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Resample Elev_UK raster to match Clim_UK raster\nElev_UK_aligned <- terra::resample(Elev_UK, Clim_UK, method = \"bilinear\")\n\n# Crop to common extent\ncommon_extent <- intersect(ext(Clim_UK), ext(Elev_UK_aligned))\nClim_UK_crop2 <- terra::crop(Clim_UK, common_extent)\nElev_UK_crop2 <- terra::crop(Elev_UK_aligned, common_extent)\n\n# Stack layers and name variables\nEnv_UK_stack <- c(Clim_UK_crop2 , Elev_UK_crop2)\nnames(Env_UK_stack) <- c(sub(\"^wc2\\\\.1_10m_\", \"\", names(Clim_UK)), \"elevation\")\n\n# Print stack summary\nprint(Env_UK_stack)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \nsize        : 130, 119, 20  (nrow, ncol, nlyr)\nresolution  : 0.08333333, 0.08333333  (x, y)\nextent      : -8.166667, 1.75, 50, 60.83333  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (EPSG:4326) \nsources     : Clim_UK.tif  (19 layers) \n              memory  \nnames       :    bio_1,    bio_2,    bio_3,    bio_4,  bio_5,  bio_6, ... \nmin values  :  3.73125, 2.468750, 26.61725, 244.1159, 13.000, -3.735, ... \nmax values  : 11.13333, 8.602083, 42.87903, 507.7567, 23.302,  5.600, ... \n```\n\n\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\" icon=\"info\"}\n### Exercises: Exploring environmental data\n\n1.  **Map climate variables across a region:**\\\n    Use `geodata::worldclim_global()` to download bioclimatic variables. Crop to a country of your choice and plot maps of temperature and precipitation. What spatial patterns do you observe?\n\n2.  **Extract climate at occurrence points:**\\\n    Use `terra::extract()` to get climate and elevation values at species occurrence points. Plot environmental gradients (e.g., temp vs. elevation). How might these relate to the species' ecology?\n\n3.  **Compare present vs. future climate:**\\\n    Extract current and CMIP6 future climate (e.g., `bio1`) at occurrence locations. Calculate and map differences. Where is the largest projected change?\n:::\n",
    "supporting": [
      "page_SDM.4_EnvironmentalData_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ensemble Model Fitting – SDM Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/sdm_favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9859d952baf36b9a7db628bbb9f3169e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/sdm_favicon.png" alt="SDM Workshop Logo" class="navbar-logo light-content">
    <img src="./images/sdm_favicon.png" alt="SDM Workshop Logo" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SDM Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-spatial-data" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Spatial Data</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-spatial-data">    
        <li>
    <a class="dropdown-item" href="./page_SDM.2_SpatialDataR.html">
 <span class="dropdown-text">Spatial Data in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./page_SDM.3_SpeciesData.html">
 <span class="dropdown-text">Species Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./page_SDM.4_EnvironmentalData.html">
 <span class="dropdown-text">Environmental Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./page_SDM.5_PseudoAbsenceData.html">
 <span class="dropdown-text">Background &amp; Pseudo-Absence Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-species-distribution-models" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Species Distribution Models</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-species-distribution-models">    
        <li>
    <a class="dropdown-item" href="./page_SDM.6_SDMSimpleModelFitting.html">
 <span class="dropdown-text">Simple Model Fitting (GLM)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./page_SDM.7_SDMAssessmentProjection.html">
 <span class="dropdown-text">Assessment &amp; Projection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./page_SDM.8_SDMCompareAlgorithms.html">
 <span class="dropdown-text">Fitting &amp; Comparing Algorithms</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./page_SDM.9_SDMEnsembleModelFitting.html">
 <span class="dropdown-text">Ensemble Modelling</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ensemble-modelling-strategies" id="toc-ensemble-modelling-strategies" class="nav-link active" data-scroll-target="#ensemble-modelling-strategies">1. Ensemble Modelling Strategies</a></li>
  <li><a href="#manual-ensemble-modelling" id="toc-manual-ensemble-modelling" class="nav-link" data-scroll-target="#manual-ensemble-modelling">2 Manual Ensemble Modelling</a></li>
  <li><a href="#packages-for-constructing-ensemble-sdms-in-r" id="toc-packages-for-constructing-ensemble-sdms-in-r" class="nav-link" data-scroll-target="#packages-for-constructing-ensemble-sdms-in-r">3. Packages for Constructing Ensemble SDMs in R</a>
  <ul class="collapse">
  <li><a href="#using-biomod2" id="toc-using-biomod2" class="nav-link" data-scroll-target="#using-biomod2">3.1 Using <code>biomod2</code></a></li>
  <li><a href="#using-sdm" id="toc-using-sdm" class="nav-link" data-scroll-target="#using-sdm">3.2 Using <code>sdm</code></a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ensemble Model Fitting</h1>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<p>Species distribution models (SDMs) are, at best, imperfect approximations of reality. They rely on <strong>human-defined mathematical structures</strong> to represent complex ecological processes, forcing observational data into simplified functional forms that may not fully capture the underlying biological mechanisms. Each model is a filtered view, shaped by <strong>assumptions, algorithmic constraints</strong>, and the <strong>quality of the available data</strong>.</p>
<p>Exploring different <strong>algorithms</strong> for SDM has shown that every method carries its own strengths and limitations—no single model consistently outperforms others across species, regions, or scenarios. This recognition has led to the growing adoption of ensemble modelling, which combines predictions from multiple algorithms to generate more robust, reliable, and generalisable estimates of species’ potential distributions.</p>
<p>The core idea behind <strong>ensemble modelling</strong> is that each individual model captures a mix of signal (i.e.&nbsp;captures some of the genuine ecological patterns) and noise (errors, biases, or uncertainties). By aggregating across models, ensembles aim to amplify the signal while dampening the noise—leading to improved <strong>predictive performance</strong> and more defensible ecological inference.</p>
<p>By combining multiple models, ensemble approaches aim not only to amplify the signal and suppress the noise, but also to provide a more reliable central tendency (e.g.&nbsp;mean or consensus prediction) across different modelling approaches. Crucially, ensembles do more than just improve average predictive performance, as they also allow us to quantify uncertainty more effectively. By comparing variation among model predictions, we can estimate the degree of confidence in our forecasts and highlight areas of high or low agreement. This makes ensembles particularly valuable for decision-making and risk assessment under uncertainty, such as conservation planning or climate impact assessments.</p>
<section id="ensemble-modelling-strategies" class="level2">
<h2 class="anchored" data-anchor-id="ensemble-modelling-strategies">1. Ensemble Modelling Strategies</h2>
<p>Ensemble modelling in species distribution modelling (SDM) is not a single method but a framework that can incorporate different strategies for combining predictions. Broadly, ensemble methods can be grouped into three categories, depending on how models are weighted and how uncertainty is handled:<br>
</p>
<section id="simple-averaging" class="level4">
<h4 class="anchored" data-anchor-id="simple-averaging">1.1 Simple averaging</h4>
<p>The most basic ensemble method calculates the unweighted average of predictions from multiple models: • Every algorithm contributes equally to the final prediction. • Assumes all models are equally informative and reliable. • Easy to implement and interpret. When to use: When you have little prior reason to favour one model over another, or want a straightforward consensus.<br>
</p>
</section>
<section id="weighted-averaging" class="level4">
<h4 class="anchored" data-anchor-id="weighted-averaging">1.2 Weighted averaging</h4>
<p>In this approach, models are weighted according to performance metrics such as AUC, TSS, or cross-validated deviance: • Better-performing models contribute more heavily to the final ensemble. • Weights can be calculated based on internal validation (e.g., cross-validation AUC), independent test data, or expert judgment. When to use: When you want to prioritize models with stronger support from the data, while still retaining a diverse model set.<br>
</p>
</section>
<section id="consensus-based-voting-or-thresholding" class="level4">
<h4 class="anchored" data-anchor-id="consensus-based-voting-or-thresholding">1.3 Consensus-based voting or thresholding</h4>
<p>Here, ensemble predictions are made by voting across binary outputs (e.g.&nbsp;habitat suitable/unsuitable): • A site is predicted suitable if a majority of models agree. • Can also use stricter rules (e.g.&nbsp;unanimity) or soft thresholds (e.g.&nbsp;70% agreement). • Useful when decisions are binary (e.g.&nbsp;protect vs not protect) or when interpretation of continuous probabilities is unclear. When to use: In policy or management contexts that require clear thresholds for decision-making.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Practical Considerations for Ensemble Modelling
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="aligning-model-outputs" class="level4">
<h4 class="anchored" data-anchor-id="aligning-model-outputs">Aligning model outputs</h4>
<p>Before combining predictions from different SDM algorithms, it’s essential to ensure they are <strong>aligned</strong>:</p>
<ul>
<li>All models should be projected onto the <strong>same spatial extent</strong>, <strong>resolution</strong>, and use the same <strong>environmental layers</strong>.</li>
<li>Predictions must be on the <strong>same scale</strong> (e.g.&nbsp;probabilities between 0 and 1).</li>
<li><strong>Model names</strong> should be clearly matched to their corresponding prediction layers or files to ensure reproducibility.</li>
</ul>
</section>
<section id="including-uncertainty-in-ensembles" class="level4">
<h4 class="anchored" data-anchor-id="including-uncertainty-in-ensembles">Including uncertainty in ensembles</h4>
<p>While most ensemble implementations focus on generating a <strong>central prediction</strong> (e.g.&nbsp;mean or weighted mean), it is equally important to assess and communicate uncertainty:</p>
<ul>
<li>Include proxies for model disagreement, such as <strong>standard deviation (SD)</strong> across predictions.</li>
<li>Calculate <strong>quantiles</strong> or <strong>prediction intervals</strong>, which are especially useful when communicating risk or making conservative decisions.</li>
<li>It is good practice to report <strong>both the ensemble mean and an uncertainty layer</strong> (e.g.&nbsp;SD or interquartile range) in any spatial output intended for planning or publication.</li>
</ul>
</section>
</div>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="manual-ensemble-modelling" class="level2">
<h2 class="anchored" data-anchor-id="manual-ensemble-modelling">2 Manual Ensemble Modelling</h2>
<p>After fitting multiple SDM algorithms and generating predictions on the same test dataset or raster stack, we can manually construct ensemble predictions by combining these outputs.</p>
<section id="prepare-model-predictions-and-evaluation-metrics" class="level4">
<h4 class="anchored" data-anchor-id="prepare-model-predictions-and-evaluation-metrics">2.1 Prepare model predictions and evaluation metrics</h4>
<p>For this example, suppose we have predicted probabilities from four based on GLM, GAM, BRT and randomForest models on the test data: <code>glm_predict_test</code>, <code>gam_predict_test</code>, <code>brt_predict_test</code>, <code>rF_predict_test</code> and their respective AUC values from validation: <code>auc_glm</code>, <code>auc_gam</code>, <code>auc_brt</code>, <code>auc_rF</code></p>
</section>
<section id="simple-average-ensemble" class="level4">
<h4 class="anchored" data-anchor-id="simple-average-ensemble">2.2 Simple average ensemble</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine predictions into a data frame</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>models_predict_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">GLM =</span> <span class="fu">as.numeric</span>(glm_predict_test),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">GAM =</span> <span class="fu">as.numeric</span>(gam_predict_test),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">BRT =</span> <span class="fu">as.numeric</span>(brt_predict_test),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">RF  =</span> <span class="fu">as.numeric</span>(rF_predict_test))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple average ensemble prediction</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>ensemble_predict_simple <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(models_predict_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="weighted-average-ensemble" class="level4">
<h4 class="anchored" data-anchor-id="weighted-average-ensemble">2.3 Weighted average ensemble</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weight vector based on AUCs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>models_auc_values <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_glm, auc_gam, auc_brt, auc_rF)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>weights_auc <span class="ot">&lt;-</span> models_auc_values <span class="sc">/</span> <span class="fu">sum</span>(models_auc_values)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Weighted average ensemble prediction</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ensemble_predict_weighted <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.matrix</span>(models_predict_df) <span class="sc">%*%</span> weights_auc)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="quantify-ensemble-uncertainty" class="level4">
<h4 class="anchored" data-anchor-id="quantify-ensemble-uncertainty">2.4 Quantify ensemble uncertainty</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ensemble_predict_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(models_predict_df, <span class="dv">1</span>, sd)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="visualise-ensemble-prediction-and-uncertainty" class="level4">
<h4 class="anchored" data-anchor-id="visualise-ensemble-prediction-and-uncertainty">2.4 Visualise ensemble prediction and uncertainty</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observation =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ensemble_predict_simple),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">SimpleMean =</span> ensemble_predict_simple,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">WeightedMean =</span> ensemble_predict_weighted,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Uncertainty =</span> ensemble_predict_sd</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(SimpleMean, WeightedMean), </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"EnsembleType"</span>, <span class="at">values_to =</span> <span class="st">"Prediction"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot predictions with uncertainty ribbon</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(<span class="at">x =</span> Observation, <span class="at">y =</span> Prediction, <span class="at">color =</span> EnsembleType)) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Prediction <span class="sc">-</span> Uncertainty, <span class="at">ymax =</span> Prediction <span class="sc">+</span> Uncertainty),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Ensemble Predictions with Uncertainty"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Test Sample Index"</span>) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="page_SDM.9_SDMEnsembleModelFitting_files/figure-html/ensemble-manual-visual-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="packages-for-constructing-ensemble-sdms-in-r" class="level2">
<h2 class="anchored" data-anchor-id="packages-for-constructing-ensemble-sdms-in-r">3. Packages for Constructing Ensemble SDMs in R</h2>
<p>R offers several packages for building and combining species distribution models, each with different strengths, model algorithms, and ways of handling ensemble predictions. Three commonly used tools are <strong><code>biomod2</code></strong>, <strong><code>sdm</code></strong>, and <strong><code>ENMeval</code></strong>.</p>
<section id="using-biomod2" class="level3">
<h3 class="anchored" data-anchor-id="using-biomod2">3.1 Using <code>biomod2</code></h3>
<p><a href="https://cran.r-project.org/package=biomod2"><code>biomod2</code></a> is a powerful and flexible package designed specifically for ensemble species distribution modelling. It supports a wide range of modelling algorithms (e.g., GLM, GAM, RF, Maxent), provides built-in tools for data preprocessing and evaluation, and includes robust ensemble functionalities.</p>
<section id="key-features" class="level4">
<h4 class="anchored" data-anchor-id="key-features">Key Features:</h4>
<ul>
<li>Supports up to ten different SDM algorithms</li>
<li>Automates cross-validation and model tuning</li>
<li>Allows weighted ensemble predictions</li>
<li>Can output uncertainty layers (e.g.&nbsp;confidence intervals, variance)</li>
</ul>
</section>
<section id="biomod2-basic-workflow" class="level4">
<h4 class="anchored" data-anchor-id="biomod2-basic-workflow"><code>biomod2</code> basic Workflow</h4>
<p>Here is an outline of how to run ensemble SDMs using <code>biomod2</code>:</p>
<section id="biomod2-step-1-format-the-input-data" class="level5">
<h5 class="anchored" data-anchor-id="biomod2-step-1-format-the-input-data"><code>biomod2</code> step 1: Format the input data</h5>
<p>To use biomod2, we need to provide presence–absence data coded as 1s and 0s, corresponding geographic coordinates (longitude and latitude), a stack of environmental predictor layers, a species name, and optional also background or absence points (if not provided will be generated by the package). Here we use the data generated earlier in the worshop (and stored also as saves/shared data for this worshop) and reformat then into the required object.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biomod2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare presence data</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>presence_df <span class="ot">&lt;-</span> presence_sf <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resp =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>                         <span class="co"># Add response variable (1 = presence)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span>                         <span class="co"># Extract coordinates</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>                          <span class="co"># Convert to data frame</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">resp =</span> <span class="dv">1</span>)                          <span class="co"># Append response column again for clarity</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare background (pseudo-absence) data</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>background_df <span class="ot">&lt;-</span> background_sf <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resp =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>                         <span class="co"># Add response variable (0 = background)</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span>                         <span class="co"># Extract coordinates</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>                          <span class="co"># Convert to data frame</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">resp =</span> <span class="dv">0</span>)                          <span class="co"># Append response column again for clarity</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine coordinates of presence and background points</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>sdm_xy <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>(presence_sf) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>(),      <span class="co"># Presence coordinates</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>(background_sf) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()     <span class="co"># Background coordinates</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create corresponding response vector (1 = presence, 0 = background)</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>sdm_resp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(presence_sf)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(background_sf)))</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename coordinate columns to match biomod2 requirements</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sdm_xy) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Select focal environmental layers</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>env_select <span class="ot">&lt;-</span> Env_UK_stack[[<span class="fu">c</span>(<span class="st">"bio_1"</span>, <span class="st">"bio_12"</span>, <span class="st">"elevation"</span>)]]</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert terra SpatRaster to RasterStack (required by biomod2)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>env_ras <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(env_select)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Format data for biomod2 modelling</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>biomod_data <span class="ot">&lt;-</span> <span class="fu">BIOMOD_FormatingData</span>(</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp.var =</span> sdm_resp,              <span class="co"># Vector of 1s and 0s</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">expl.var =</span> env_ras,               <span class="co"># Environmental predictors as RasterStack</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp.xy =</span> sdm_xy,                 <span class="co"># Coordinates of all points</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp.name =</span> <span class="st">"Rhinolophus_hipposideros"</span>,  <span class="co"># Species name (used to label outputs)</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">PA.nb.rep =</span> <span class="dv">0</span>                     <span class="co"># No pseudo-absence generation needed (already supplied)</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
-=-=-=-=-=-=-=-=-=-= Rhinolophus_hipposideros Data Formating -=-=-=-=-=-=-=-=-=-=

      ! Response variable name was converted into Rhinolophus.hipposideros
 !!! Some data are located in the same raster cell. 
          Please set `filter.raster = TRUE` if you want an automatic filtering.
      ! No data has been set aside for modeling evaluation
 ! Some NAs have been automatically removed from your data
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= Done -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</code></pre>
</div>
</div>
</section>
<section id="biomod2-step-2-define-and-fit-individual-models" class="level5">
<h5 class="anchored" data-anchor-id="biomod2-step-2-define-and-fit-individual-models"><code>biomod2</code> step 2: Define and fit individual models</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default model options (can be customised per algorithm)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mod_options <span class="ot">&lt;-</span> <span class="fu">bm_ModelingOptions</span>(<span class="at">data.type =</span> <span class="st">'binary'</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">models =</span> <span class="fu">c</span>(<span class="st">"GLM"</span>, <span class="st">"RF"</span>, <span class="st">"GBM"</span>, <span class="st">"GAM"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">strategy =</span> <span class="st">'default'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Run SDMs using selected algorithms</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit individual species distribution models using biomod2</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>myBiomodModelOut <span class="ot">&lt;-</span> <span class="fu">BIOMOD_Modeling</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bm.format =</span> biomod_data,               <span class="co"># Formatted input data</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">modeling.id =</span> <span class="st">"AllModels"</span>,             <span class="co"># Unique ID for this modelling run</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> <span class="fu">c</span>(<span class="st">"GLM"</span>, <span class="st">"RF"</span>, <span class="st">"GBM"</span>, <span class="st">"GAM"</span>),  <span class="co"># SDM algorithms to fit</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cross-validation settings</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV.strategy =</span> <span class="st">"random"</span>,                <span class="co"># Randomly split data into train/test</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV.nb.rep =</span> <span class="dv">2</span>,                         <span class="co"># Number of cross-validation replicates</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV.perc =</span> <span class="fl">0.7</span>,                         <span class="co"># 70% data used for training, 30% for testing</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model optimization and evaluation</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">OPT.strategy =</span> <span class="st">"bigboss"</span>,             <span class="co"># Optimisation strategy (biomod2 default)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric.eval =</span> <span class="fu">c</span>(<span class="st">"TSS"</span>, <span class="st">"ROC"</span>),        <span class="co"># Evaluation metrics to use</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.import =</span> <span class="dv">2</span>,                       <span class="co"># Number of permutations for variable importance</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed.val =</span> <span class="dv">42</span>                         <span class="co"># Random seed for reproducibility</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="biomod2-step-3-build-ensemble-model" class="level5">
<h5 class="anchored" data-anchor-id="biomod2-step-3-build-ensemble-model"><code>biomod2</code> step 3: Build ensemble model</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect model evaluation metrics for each algorithm and CV replicate</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_evaluations</span>(myBiomodModelOut) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>These evaluation results show that some models (e.g.&nbsp;RF) tend to have higher ROC/TSS etc., meaning better discrimination and more confidence; others may be lower, which suggests more caution or lower predictability under your environmental data.</p>
</section>
<section id="biomod2-step-4-ensemble-prediction-and-uncertainty-mapping" class="level5">
<h5 class="anchored" data-anchor-id="biomod2-step-4-ensemble-prediction-and-uncertainty-mapping"><code>biomod2</code> step 4: Ensemble prediction and uncertainty mapping</h5>
<p>Here we combine models, project them spatially, generate ensemble outputs (mean probability, weighted mean, and uncertainty), then forecast ensemble to new environmental rasters</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Project individual models to environmental raster layers</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>model_proj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_Projection</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">bm.mod        =</span> myBiomodModelOut,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">new.env       =</span> env_ras,           <span class="co"># raster stack of environmental predictors</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">proj.name     =</span> <span class="st">"current"</span>,         <span class="co"># a label for this projection scenario</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary.meth   =</span> <span class="st">"TSS"</span>,             <span class="co"># thresholding method for binary maps</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">compress      =</span> <span class="cn">FALSE</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
-=-=-=-=-=-=-=-=-=-=-=-=-= Do Single Models Projection -=-=-=-=-=-=-=-=-=-=-=-=-=

    &gt; Building clamping mask

    &gt; Projecting Rhinolophus.hipposideros_allData_RUN1_GLM ...
    &gt; Projecting Rhinolophus.hipposideros_allData_RUN1_RF ...
    &gt; Projecting Rhinolophus.hipposideros_allData_RUN1_GBM ...
    &gt; Projecting Rhinolophus.hipposideros_allData_RUN2_GLM ...
    &gt; Projecting Rhinolophus.hipposideros_allData_RUN2_RF ...
    &gt; Projecting Rhinolophus.hipposideros_allData_RUN2_GBM ...
    &gt; Projecting Rhinolophus.hipposideros_allData_allRun_GLM ...
    &gt; Projecting Rhinolophus.hipposideros_allData_allRun_RF ...
    &gt; Projecting Rhinolophus.hipposideros_allData_allRun_GBM ...
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= Done -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the ensemble using all cross-validation replicates</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>myEnsembleOut <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleModeling</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">bm.mod                =</span> myBiomodModelOut,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">em.by                 =</span> <span class="st">"all"</span>,                     <span class="co"># combine all CV runs</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">em.algo               =</span> <span class="fu">c</span>(<span class="st">"EMmean"</span>, <span class="st">"EMcv"</span>, <span class="st">"EMwmean"</span>), <span class="co"># different ensemble methods: mean, coefficient of variation (CV=uncertainty), weighted mean</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric.select         =</span> <span class="st">"TSS"</span>,                     <span class="co"># metric for selecting which models to include</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric.select.thresh  =</span> <span class="fl">0.5</span>                        <span class="co"># only include individual models with TSS ≥ 0.5</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
-=-=-=-=-=-=-=-=-=-=-=-=-=-= Build Ensemble Models -=-=-=-=-=-=-=-=-=-=-=-=-=-=

   ! all models available will be included in ensemble.modeling
  ! Ensemble Models will be filtered and/or weighted using validation dataset (if possible). Please use `metric.select.dataset` for alternative options.
   &gt; Evaluation &amp; Weighting methods summary :
      TSS over 0.5

!!! Removed models using the Full dataset as ensemble models cannot merge repetition dataset (RUN1, RUN2, ...) with Full dataset unless em.by = 'PA+run'.

  &gt; mergedData_mergedRun_mergedAlgo ensemble modeling
   &gt; Mean of probabilities by TSS ...
   &gt; Coef of variation of probabilities by TSS ...
          original models scores =  0.598 0.66 0.679 0.652 0.635 0.647
          final models weights =  0.154 0.17 0.175 0.168 0.164 0.167
   &gt; Probabilities weighting mean by TSS ...</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in {: task 1 failed - "task 1 failed - "task 1 failed - "cannot open the connection"""</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the ensemble to the projections</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>myEnsembleProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">bm.em   =</span> myEnsembleOut,         <span class="co"># ensemble modeling object</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">bm.proj =</span> model_proj             <span class="co"># projections from individual models</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
-=-=-=-=-=-=-=-=-=-=-=-= Do Ensemble Models Projection -=-=-=-=-=-=-=-=-=-=-=-=</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'myEnsembleOut' not found</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise mean suitability, CV, and weigthed suitabilty onto map</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract layers from biomod2 ensemble projection</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ens_stack <span class="ot">&lt;-</span> <span class="fu">get_predictions</span>(myEnsembleProj)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'obj' in selecting a method for function 'get_predictions': object 'myEnsembleProj' not found</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename for clarity (adjust names if needed)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ens_stack) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Suitability_mean"</span>, <span class="st">"CV"</span>, <span class="st">"Suitability_weighted"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'ens_stack' not found</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make 0-values in the weighted layer transparent</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set values of 0 to NA in the weighted layer</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>ens_stack<span class="sc">$</span>Suitability_weighted[ens_stack<span class="sc">$</span>Suitability_weighted <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'ens_stack' not found</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all three side-by-side</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ens_stack,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Mean Suitability"</span>, <span class="st">"Cross-Validation Variation"</span>, <span class="st">"Weighted Suitability"</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">colNA =</span> <span class="st">"transparent"</span>,       <span class="co"># Show NA (0-values) as transparent</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">nc =</span> <span class="dv">3</span>,                      <span class="co"># Number of columns in layout</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>))         <span class="co"># Margins</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'ens_stack' not found</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="using-sdm" class="level3">
<h3 class="anchored" data-anchor-id="using-sdm">3.2 Using <code>sdm</code></h3>
<p>The <code>sdm</code> package in R is another powerful tool for species distribution modeling that supports many algorithms, cross-validation, and ensemble modeling. It is user-friendly and integrates well with spatial data.</p>
<section id="key-features-1" class="level4">
<h4 class="anchored" data-anchor-id="key-features-1">Key Features:</h4>
<ul>
<li>Supports multiple algorithms (GLM, GAM, RF, Maxent, etc.)</li>
<li>Easy setup of cross-validation and replication</li>
<li>Built-in ensemble modeling and projection</li>
<li>Outputs predictions and variable importance metrics</li>
</ul>
</section>
<section id="sdm-basic-workflow" class="level4">
<h4 class="anchored" data-anchor-id="sdm-basic-workflow"><code>sdm</code> basic Workflow</h4>
<p>Here is an outline of how to run ensemble SDMs using <code>sdm</code>:</p>
<section id="sdm-step-1-format-the-input-data" class="level5">
<h5 class="anchored" data-anchor-id="sdm-step-1-format-the-input-data"><code>sdm</code> step 1: Format the input data</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sdm)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert tibbles of pre-prepared sdm training and testing data subsets to base data.frames</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>sdmData_df_train <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sdm_df_train)[, <span class="fu">c</span>(<span class="st">"pa"</span>, <span class="st">"bio_1"</span>, <span class="st">"bio_12"</span>, <span class="st">"elevation"</span>)]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>sdmData_df_test  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sdm_df_test)[, <span class="fu">c</span>(<span class="st">"pa"</span>, <span class="st">"bio_1"</span>, <span class="st">"bio_12"</span>, <span class="st">"elevation"</span>)]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure response variable is numeric</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>sdmData_df_train<span class="sc">$</span>pa <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(sdmData_df_train<span class="sc">$</span>pa))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>sdmData_df_test<span class="sc">$</span>pa  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(sdmData_df_test<span class="sc">$</span>pa))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define formula using only selected predictors</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>formula_selected <span class="ot">&lt;-</span> pa <span class="sc">~</span> bio_1 <span class="sc">+</span> bio_12 <span class="sc">+</span> elevation</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sdmData object using the pre-prepared sdm training and testing data subsets</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>sdmData_df <span class="ot">&lt;-</span> sdm<span class="sc">::</span><span class="fu">sdmData</span>(</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  pa <span class="sc">~</span> bio_1<span class="sc">+</span>bio_12<span class="sc">+</span>elevation,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> sdmData_df_train,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> sdmData_df_test</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sdm-step-2-fit-models-with-cross-validation" class="level5">
<h5 class="anchored" data-anchor-id="sdm-step-2-fit-models-with-cross-validation"><code>sdm</code> step 2: Fit models with cross-validation</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit SDMs using multiple algorithms with replication (e.g., CV)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Available algorithms: 'glm', 'rf', 'brt', 'svm', 'mars', 'gam', etc.</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>sdm_model <span class="ot">&lt;-</span> sdm<span class="sc">::</span><span class="fu">sdm</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> pa <span class="sc">~</span> bio_1 <span class="sc">+</span> bio_12 <span class="sc">+</span> elevation,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sdmData_df,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">methods =</span> <span class="fu">c</span>(<span class="st">"glm"</span>, <span class="st">"gam"</span>, <span class="st">"rf"</span>, <span class="st">"brt"</span>),         <span class="co"># SDM algorithms</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at">test.percent =</span> <span class="dv">0</span>   <span class="co"># use external test data supplied in sdmData_df</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sdm-step-3-evaluate-model-performance" class="level5">
<h5 class="anchored" data-anchor-id="sdm-step-3-evaluate-model-performance"><code>sdm</code> step 3: Evaluate model performance</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View evaluation metrics: AUC, TSS, ...</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>eval_sdm <span class="ot">&lt;-</span> sdm<span class="sc">::</span><span class="fu">getEvaluation</span>(sdm_model, <span class="at">stat =</span> <span class="fu">c</span>(<span class="st">"AUC"</span>, <span class="st">"TSS"</span>, <span class="st">"sensitivity"</span>, <span class="st">"specificity"</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eval_sdm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  modelID   AUC    TSS sensitivity specificity
1       1 0.817 0.5189      0.9114      0.6075
2       2 0.871 0.6591      0.9114      0.7477
3       3 0.896 0.6497      0.9114      0.7383
4       4 0.860 0.6018      0.8354      0.7664</code></pre>
</div>
</div>
<p>All four algorithms perform reasonably well at predicting species presence and absence, but there are differences in their strengths. The GLM (model 1) has very high sensitivity, meaning it rarely misses actual presences, but lower specificity, so it predicts some false presences. In contrast, the Random Forest (model 3) achieves the best overall balance (highest TSS) and good AUC, indicating it correctly predicts both presences and absences reliably. This illustrates why no single model is perfect, and why ensemble modelling — combining predictions from multiple algorithms — can improve robustness and account for different strengths and weaknesses of individual models.</p>
</section>
<section id="sdm-step-4-variable-importance" class="level5">
<h5 class="anchored" data-anchor-id="sdm-step-4-variable-importance"><code>sdm</code> step 4: Variable importance</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess variable importance</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>varimp_sdm <span class="ot">&lt;-</span> <span class="fu">getVarImp</span>(sdm_model, <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)  <span class="co"># Adjust ID to match your models if needed</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(varimp_sdm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="page_SDM.9_SDMEnsembleModelFitting_files/figure-html/sdm-varimp-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sdm-step-5-project-model-spatially" class="level5">
<h5 class="anchored" data-anchor-id="sdm-step-5-project-model-spatially"><code>sdm</code> step 5: Project model spatially</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select focal environmental layers</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>env_select <span class="ot">&lt;-</span> Env_UK_stack[[<span class="fu">c</span>(<span class="st">"bio_1"</span>, <span class="st">"bio_12"</span>, <span class="st">"elevation"</span>)]]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Project model onto environmental space</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>sdm_proj <span class="ot">&lt;-</span> <span class="fu">predict</span>(sdm_model, <span class="at">newdata =</span> env_select, <span class="at">type=</span><span class="st">"ensemble"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot predictions</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sdm_proj)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="page_SDM.9_SDMEnsembleModelFitting_files/figure-html/sdm-projec-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Literature
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Araújo, M. B., &amp; New, M. (2007). <strong>Ensemble forecasting of species distributions.</strong> <em>Trends in Ecology and Evolution</em>, 22(1), 42–47.</p>
<p>Dormann Carsten, F., Calabrese Justin, M., Guillera‐Arroita, G., Matechou, E., Bahn, V., Bartoń, K., . . . Hartig, F. (2018). <strong>Model averaging in ecology: a review of Bayesian, information‐theoretic and tactical approaches for predictive inference.</strong> <em>Ecological Monographs</em>, 88(4): 485–504. <a href="https://doi.org/10.1002/ecm.1309">doi:10.1002/ecm.1309</a></p>
<p>Hao, T., Elith, J., Lahoz-Monfort, J. J., &amp; Guillera-Arroita, G. (2020). <strong>Testing whether ensemble modelling is advantageous for maximising predictive performance of species distribution models.</strong> <em>Ecography</em>, 43(4), 549–558. <a href="https://doi.org/10.1111/ecog.04890">doi:10.1111/ecog.04890</a></p>
<p>Naimi, B., &amp; Araújo, M. B. (2016). <strong>sdm: a reproducible and extensible R platform for species distribution modelling.</strong> <em>Ecography</em>, 39(4), 368–375. <a href="https://doi.org/10.1111/ecog.01881">doi:10.1111/ecog.01881</a></p>
<p>Thuiller, W., Lafourcade, B., Engler, R., &amp; Araújo, M. B. (2009). <strong>BIOMOD - A platform for ensemble forecasting of species distributions.</strong> <em>Ecography</em>, 32(3), 369–373. <a href="https://doi.org/10.1111/j.1600-0587.2008.05742.x">doi/10.1111/j.1600-0587.2008.05742.x</a></p>
<p>Zurell, D., Zimmermann, N. E., Gross, H., Baltensweiler, A., Sattler, T., &amp; Wüest, R. O. (2020). <strong>Testing species assemblage predictions from stacked and joint species distribution models.</strong> <em>Journal of Biogeography</em>, 47(1), 101–113. <a href="https://doi.org/10.1111/jbi.13608">doi:10.1111/jbi.13608</a></p>
</div>
</div>
</div>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/konswells1\.github\.io\/SDM-Workshop");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Konstans Wells, Swansea University, 2025</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>License: <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></p>
</div>
  </div>
</footer>




</body></html>